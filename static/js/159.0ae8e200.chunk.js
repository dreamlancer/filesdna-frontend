(this.webpackJsonpfilesdna=this.webpackJsonpfilesdna||[]).push([[159],{1033:function(e,t,n){"use strict";n.r(t);n(65);var a=n(66),r=(n(72),n(73)),i=n(29),s=n(0),c=n.n(s),o=n(45),l=n(53),d=n(93),u=n(187),v=n(184),p=n(110),m=n(427),f=u.a.setUserObj;t.default=function(e){var t,n=e.user,s=e.callback,u=e.guest,g=e.onHandleCancel,h=Object(l.isObject)(n)?n:{},b=Object(d.useDispatch)(),y=h.is_verify_liveness&&0!==h.is_verify_liveness;return c.a.createElement(p.d,null,c.a.createElement(a.a,{gutter:[16]},s?c.a.createElement(r.a,{xs:24},c.a.createElement("h1",{className:"livenessDetectionSystem"},"Liveness Detection System")):c.a.createElement(r.a,{xs:24},c.a.createElement("h2",{className:"userSettingsTitle"},c.a.createElement(o.a,{id:"settings.userVerification"}),c.a.createElement("small",{className:"ml5"},"(".concat((null===v.j||void 0===v.j||null===(t=v.j.is_verify_liveness)||void 0===t?void 0:t.weightage)||0,"%)")))),c.a.createElement(r.a,{xs:24},c.a.createElement("div",{className:"mt15"},c.a.createElement(a.a,null,c.a.createElement(r.a,{xs:24,xxl:24},c.a.createElement(m.a,{isLivenessVerified:y,updateUserData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;s?s():b(f(Object(i.a)(Object(i.a)({},h),{},{is_verify_liveness:e})))},email:(null===n||void 0===n?void 0:n.email)||(null===u||void 0===u?void 0:u.guestEmail),temporaryEnable:"undefined"!==typeof s,guest:u,callback:s,onHandleCancel:g})))))))}},427:function(e,t,n){"use strict";n(204);var a=n(205),r=n(29),i=(n(437),n(623)),s=n(35),c=n.n(s),o=n(33),l=n(46),d=n(52),u=n(76),v=n(55),p=n(54),m=(n(94),n(92)),f=n(0),g=n.n(f),h=n(453),b=n(61),y=n(45),E=n(68),x=n(69),j=n(360),O=n(209),w=n(447),k=n.n(w),S=n(53),L=n(364),D=n.n(L),C=n(214),T=n(5);function M(){var e=Object(T.a)(["\n  flex-direction: row;\n  margin-top: 15px;\n\n  & .scannerMain {\n    position: relative;\n\n    & > div {\n     \n    }\n  }\n\n  & .canvasMain {\n    top: 0px;\n    left: 0px;\n    position: absolute;\n    right: 0px;\n    bottom: 0px;\n\n    & canvas {\n      top: 0px;\n      left: 0px;\n      right: 0px;\n      bottom: 0px;\n      position: absolute;\n    }\n  }\n\n  & .playerMain {\n    top: 0px;\n    left: 0px;\n    position: absolute;\n    width: 100%;\n    height: 100%;\n  }\n\n  & .scanningPlace {\n    text-align: center;\n    border: 2px dashed #ccc;\n    border-radius: 3px;\n\n    & img {\n      max-width: 75%;\n      opacity: 0.5;\n    }\n  }\n\n  & .scanActions {\n    margin-top: 20px;\n    display: flex;\n\n    & > div {\n      // padding-right: 30px;\n      // margin-right: 30px;\n      // min-width: 25%;\n      margin-left:20px;\n\n      &:not(:last-child) {\n        border-right: 1px solid #e5e5e5;\n      }\n\n      & P {\n        margin-bottom: 7px;\n      }\n    }\n\n    & button {\n      margin-right: 10px;\n    }\n  }\n"]);return M=function(){return e},e}var N=n(4).d.div(M()),P=n(93),R=n(187),F=0,_=0,U=0,B=m.a.confirm,W=C.a.livenessUrl,A=R.a.setTempEnrolled,H=function(e){Object(v.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).video=g.a.createRef(),a.canvas=g.a.createRef(),a.capture=g.a.createRef(),a.stopCameraAccess=function(){if(a.mediaStream)try{a.mediaStream.getTracks().forEach((function(e){e.stop()}))}catch(e){console.log("\ud83d\ude80 ~ Scanner ~ componentWillUnmount ~ err",e)}},a.startCameraAccess=Object(o.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}});case 3:a.mediaStream=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),console.log("\ud83d\ude80 ~ Scanner ~ startCameraAccess ~ err",e.t0);case 9:case"end":return e.stop()}}),e,null,[[0,6]])}))),a.init=Object(o.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,h.d.tinyFaceDetector.load("/models/");case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.log("\ud83d\ude80 ~ Scanner ~ init ~ err",e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])}))),a.clearCanvas=function(){var e,t=null===(e=a.canvas)||void 0===e?void 0:e.current;t&&t.getContext("2d").clearRect(0,0,t.clientWidth,t.clientHeight)},a.onPlay=Object(o.a)(c.a.mark((function e(){var t,n,r,i,s,o,l,d,u,v,p,m;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a.video.current.paused&&!a.video.current.ended&&h.d.tinyFaceDetector.params){e.next=3;break}return setTimeout((function(){return a.onPlay()})),e.abrupt("return");case 3:if(t=a.state.processingMode,n=new h.a({inputSize:512,scoreThreshold:.5}),null==a.video.current){e.next=11;break}return e.next=8,h.b(a.video.current,n);case 8:if(r=e.sent,i=(new Date).getTime()/1e3,"enroll"===t&&i-_>15)a.processingDone(),Object(E.a)("error","liveness.enrollTimeout");else if("verify"===t&&i-_>15)a.processingDone(),Object(E.a)("error","liveness.verifyTimeout");else if(r){try{l=a.canvas.current,d=h.e(r,{width:null===(s=a.video.current)||void 0===s?void 0:s.width,height:null===(o=a.video.current)||void 0===o?void 0:o.height}),u=new h.c.DrawBox(d.box,{label:"",boxColor:"green",lineWidth:2}),a.drawRect(0,0,-1,-1,"red"),u.draw(l)}catch(c){console.log("\ud83d\ude80 ~ Scanner ~ onPlay= ~ err",c)}1===F&&(F=2,(v=a.capture.current).width=a.video.current.videoWidth,v.height=a.video.current.videoHeight,(p=v.getContext("2d")).drawImage(a.video.current,0,0,a.video.current.videoWidth,a.video.current.videoHeight),m=v.toDataURL("image/jpg"),"enroll"===t?a.enrollFace(m):"verify"===t&&a.verifyFace(m),p&&p.clearRect(0,0,v.width,v.height))}else a.drawRect(0,0,-1,-1,"red");case 11:setTimeout((function(){return a.onPlay()}),1e3);case 12:case"end":return e.stop()}}),e)}))),a.enrollFace=function(){var e=Object(o.a)(c.a.mark((function e(t){var n,r,s,o,l,d,u;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.setState({enrollLoading:!0}),n=a.props.email,e.prev=2,e.next=5,D.a.post("".concat(W,"/enroll_user"),{image:t,name:n},{headers:x.b});case 5:d=e.sent,a.setState({enrollLoading:!1}),u=a.props.callback,"Enroll OK"===(null===d||void 0===d||null===(r=d.data)||void 0===r?void 0:r.status)?(F=0,a.video.current.srcObject=null,a.processingDone({isEnrolled:!0}),a.clearCanvas(),Object(E.a)("success","liveness.faceEnrolled"),u&&a.props.setTempEnrolled(!0)):"Move Closer"===(null===d||void 0===d||null===(s=d.data)||void 0===s?void 0:s.status)?(i.b.info(Object(O.a)("liveness.goCloser")),F=1,_=(new Date).getTime()/1e3):"Go Back"===(null===d||void 0===d||null===(o=d.data)||void 0===o?void 0:o.status)?(i.b.info(Object(O.a)("liveness.goBack")),F=1,_=(new Date).getTime()/1e3):"Liveness Failed"===(null===d||void 0===d||null===(l=d.data)||void 0===l?void 0:l.status)?(Object(E.a)("error","liveness.enrollFailed"),F=1,_=(new Date).getTime()/1e3):(F=1,_=(new Date).getTime()/1e3,Object(E.a)("error")),e.next=17;break;case 11:e.prev=11,e.t0=e.catch(2),F=1,_=(new Date).getTime()/1e3,a.setState({enrollLoading:!1}),Object(E.a)("error");case 17:case"end":return e.stop()}}),e,null,[[2,11]])})));return function(t){return e.apply(this,arguments)}}(),a.verifyFace=function(){var e=Object(o.a)(c.a.mark((function e(t){var n,r,s,o,l,d,u,v,p,m,f,g;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.props,r=n.type,s=n.email,o=n.isLivenessVerified,l=n.updateUserData,d=n.temporaryEnable,a.setState({verifyLoading:!0}),e.prev=2,e.next=5,D.a.post("".concat(W,"/verify_user_with_name"),{image:t,name:s},{headers:x.b});case 5:"Verify OK"===(null===(g=e.sent)||void 0===g||null===(u=g.data)||void 0===u?void 0:u.status)&&(null===g||void 0===g||null===(v=g.data)||void 0===v?void 0:v.liveness)>.8?(Object(E.a)("success","liveness.faceVerified"),a.clearCanvas(),a.processingDone({verifyLoading:!1}),d?(a.setState({isEnrolled:!1,verifyLoading:!1}),a.props.setTempEnrolled(!1),l()):"verify"===r&&o?l():o||a.verifyLivenes()):"Move Closer"===(null===g||void 0===g||null===(p=g.data)||void 0===p?void 0:p.status)?(i.b.info(Object(O.a)("liveness.goCloser")),U=0,F=1,_=(new Date).getTime()/1e3,U+=1):"Go Back"===(null===g||void 0===g||null===(m=g.data)||void 0===m?void 0:m.status)?(i.b.info(Object(O.a)("liveness.goBack")),U=0,F=1,_=(new Date).getTime()/1e3,U+=1):"No Users"===(null===g||void 0===g||null===(f=g.data)||void 0===f?void 0:f.status)?(Object(E.a)("error","liveness.enrollErr"),a.processingDone()):(F=1,_=(new Date).getTime()/1e3,U+=1),U>=10&&(a.processingDone(),Object(E.a)("error","liveness.verifyFailed")),a.setState({verifyLoading:!1}),e.next=18;break;case 11:e.prev=11,e.t0=e.catch(2),F=1,_=(new Date).getTime()/1e3,U+=1,Object(E.a)("error"),a.setState({verifyLoading:!1});case 18:case"end":return e.stop()}}),e,null,[[2,11]])})));return function(t){return e.apply(this,arguments)}}(),a.processingStart=function(){var e=Object(o.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.startCameraAccess();case 2:F=1,U=0,_=(new Date).getTime()/1e3,a.video.current.srcObject=a.mediaStream,a.setState({resetLoading:!1,processingMode:t});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.prepareEnroll=Object(o.a)(c.a.mark((function e(){var t,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=a.props.guest,(n=void 0===t?null:t)&&n.isGuest?a.processingStart("enroll"):a.resetLiveness("enroll",(function(){a.processingStart("enroll")}));case 2:case"end":return e.stop()}}),e)}))),a.handleButton=function(e){var t=a.state,n=t.enrollLoading,r=t.verifyLoading,i=t.processingMode,s=t.isEnrolled;i||n||r||("enroll"!==e||s?a.processingStart(e):a.prepareEnroll())},a.verifyLivenes=Object(o.a)(c.a.mark((function e(){var t,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.props.updateUserData,e.prev=1,e.next=4,Object(x.a)("liveness/verify",{},"post");case 4:(n=e.sent).success?(t(),a.setState({isEnrolled:!1,verifyLoading:!1})):(Object(E.a)("error",n.message),a.setState({verifyLoading:!1})),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),a.setState({verifyLoading:!1}),Object(E.a)("error");case 12:case"end":return e.stop()}}),e,null,[[1,8]])}))),a.resetLiveness=Object(o.a)(c.a.mark((function e(){var t,n,r,i,s=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:"",n=s.length>1&&void 0!==s[1]?s[1]:null,r=a.props.updateUserData,a.setState({resetLoading:t}),e.prev=4,e.next=7,Object(x.a)("liveness/reset",{},"POST");case 7:(i=e.sent).success?Object(S.isFunction)(n)?n(i):(Object(E.a)("success","liveness.deleteSuccess"),r(0)):Object(E.a)("error"),a.processingDone({resetLoading:!1}),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(4),a.setState({resetLoading:!1}),Object(E.a)("error");case 16:case"end":return e.stop()}}),e,null,[[4,12]])}))),a.handleResetLiveness=function(){var e=Object(u.a)(a);B({title:Object(O.a)("common.areuSure"),content:Object(O.a)("liveness.deleteConfirm"),icon:g.a.createElement(j.a,null),maskClosable:!0,okText:Object(O.a)("common.delete"),okButtonProps:{type:"danger",id:"danger-btn"},onOk:function(){e.resetLiveness("reset")}})},a.state={verifyLoading:!1,enrollLoading:!1,isEnrolled:!1,processingMode:""},a.processingStart=a.processingStart.bind(Object(u.a)(a)),a}return Object(d.a)(n,[{key:"componentDidMount",value:function(){var e=this.canvas.current;e&&(e.width=e.clientWidth,e.height=e.clientHeight,this.ctx=e.getContext("2d")),this.init()}},{key:"componentWillUnmount",value:function(){this.stopCameraAccess()}},{key:"drawRect",value:function(e,t,n,a,r){try{this.ctx.beginPath(),this.ctx.clearRect(0,0,this.canvas.current.clientWidth,this.canvas.current.clientHeight),this.ctx.strokeStyle=r,this.ctx.lineWidth=3,this.ctx.rect(e,t,n,a),this.ctx.stroke()}catch(i){console.log("\ud83d\ude80 ~ drawRect ~ err",i)}}},{key:"processingDone",value:function(){var e=Object(o.a)(c.a.mark((function e(){var t,n=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},F=0,this.drawRect(0,0,-1,-1,"red"),this.video.current.srcObject=null,e.next=6,this.stopCameraAccess();case 6:this.setState(Object(r.a)({resetLoading:!1,processingMode:""},t&&Object(r.a)({},t)));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state,n=t.resetLoading,r=t.isEnrolled,i=this.props,s=i.isLivenessVerified,c=i.type,o=i.callback,l=i.onHandleCancel,d=i.cancelLoading,u=i.goVerifyBack,v=i.verifyingDevice,p="verify"===c;return g.a.createElement("div",{className:"verifyContainer"},!p&&g.a.createElement("div",{className:"titleContent"},g.a.createElement("h3",null,g.a.createElement(y.a,{id:"".concat(s?"liveness.testEnrolled":"liveness.scanFace")})),g.a.createElement("p",null,g.a.createElement(y.a,{id:"liveness.enrollSub"}))),g.a.createElement(N,{type:c},g.a.createElement("div",{className:"scannerMain"},g.a.createElement("div",{className:"playerMain"},g.a.createElement("video",{ref:this.video,autoPlay:!0,muted:!0,playsinline:!0,onPlay:this.onPlay,width:"100%"})),g.a.createElement("div",{className:"scanningPlace"},g.a.createElement("img",{src:k.a,alt:"Face Scanning"})),g.a.createElement("div",{className:"canvasMain"},g.a.createElement("canvas",Object.assign({id:"face-canvas",ref:this.canvas},"verify"===c?{width:350,height:264}:{width:640,height:480})),g.a.createElement("canvas",{id:"capture-canvas",ref:this.capture}))),g.a.createElement("div",{className:"scanActions"},o&&g.a.createElement("div",{className:"cancel"},g.a.createElement(b.a,{type:"primary",onClick:l},g.a.createElement(y.a,{id:"common.cancel"}))),!!p&&g.a.createElement(b.a,{key:"goback",loading:d,onClick:function(){return d?null:u(v?"cancel":"")}},g.a.createElement(y.a,{id:"common.cancel"})),!s&&!p&&g.a.createElement("div",{style:r?{opacity:.4}:{}},!o&&g.a.createElement("p",null,g.a.createElement(y.a,{id:"liveness.step1"})),g.a.createElement(b.a,{loading:"enroll"===n,disabled:r,type:"primary",onClick:function(){return e.handleButton("enroll")}},g.a.createElement(y.a,{id:"voice.enroll"}))),g.a.createElement("div",null,!s&&!o&&g.a.createElement("p",null,g.a.createElement(y.a,{id:"liveness.step2"})),g.a.createElement(b.a,{disabled:!r&&!s,type:"primary",onClick:function(){return e.handleButton("verify")}},g.a.createElement(y.a,{id:"settings.verify"})))),!p&&s?g.a.createElement(g.a.Fragment,null,g.a.createElement(a.a,null),g.a.createElement("div",{className:"deleteVoice"},g.a.createElement("p",{className:"mb10"},g.a.createElement(y.a,{id:"liveness.deleteNote"})),g.a.createElement(b.a,{loading:"reset"===n,onClick:this.handleResetLiveness,size:"small",danger:!0},g.a.createElement(y.a,{id:"liveness.resetLiveness"})))):null))}}]),n}(g.a.Component);H.defaultProps={temporaryEnable:!1,isGuest:!1};t.a=Object(P.connect)(null,{setTempEnrolled:A})(H)},441:function(e,t){},442:function(e,t){},443:function(e,t){},447:function(e,t,n){e.exports=n.p+"static/media/scanning.d841705a.gif"}}]);